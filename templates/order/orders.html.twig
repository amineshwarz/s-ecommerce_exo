{% extends 'base.html.twig' %}

{% block title %}Hello OrderController!{% endblock %}

{% block body %}
<h1 class="text-center mb-5" style="margin-top:3em;">Historique de vos commande</h1>
{{ include ('layouts/_flash_message.html.twig') }}

{% if orders is empty %}
    <div class="alert alert-info text-center" role="alert">
        Vous n'avez pas encore passé de commande.
    </div>
{% endif %}
<div class='order-card text-center'>
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Nom</th>
                <th scope="col">Prénom</th>
                <th scope="col">Téléphone</th>
                <th scope="col">Adresse</th>
                <th scope="col">Ville</th>
                <th scope="col">Action</th> 
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
                
             
                <tr>
                    <td>{{ order.firstName }}</td>
                    <td>{{ order.lastName }}</td>
                    <td>{{ order.phone}} </td>
                    <td>{{ order.adresse }}</td>
                    <td>{{ order.city.name }}</td>
                    <td>
                        <a href="#" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#productModal{{ order.id }}"> détails</a>
                    </td>   
                </tr>
                {% for product in order.orderproducts %}
                <tr>
                    <td>{{ product.product.name }}</td>
                    <td>{{ product.qte }}</td>
                    <td>{{ product.product.prix }} €</td>
                    <td>{{ product.product.prix*product.qte}} €</td>     
                    <td>
                        <span> Frais de livraison : {{ order.city.shippingCost }} €</span>
                        <h5 class='mb-5'> Total de la commande : {{ order.totalPrice }} €</h5> 
                        {% if order.isCompleted != true %}
                            <a href="{{ path('app_order_is-completed-update',{'id':order.id}) }}" class="btn btn-sm btn-green">Marquer comme livrée</a> 
                        {% endif %}
                        <a href="{{ path('app_order_remove',{'id':order.id}) }}" class="btn btn-sm btn-danger" onclick="return confirm('Es-tu sûr de vouloir supprimer cet élément ?');">Supprimer</a>
                        <a href="{{ path('app_bill', {'id': order.id}) }}" class="btn btn-sm btn-info">Facture</a>
                    </td>
                    <td>
                        <span class='text-primary'> Informations du client :</span>
                        <h4> commande n°{{ order.id }}</h2>
                        {% if order.isCompleted == true %}
                            <span class="badge bg-success mb-3">Commande livrée</span>
                        {% else %}
                            <span class="badge bg-danger mb-3">Commande non livrée</span>
                        {% endif %}
                        <br>
                    </td>
                </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>

    <div class=" mx-5 justify-content-center">
        {{ knp_pagination_render(orders, 'layouts/paginator.html.twig') }}
    </div>

</div>
 
{% endblock %}
